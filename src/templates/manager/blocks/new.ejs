<form action="/manager/blocks/new" method="POST">
  <label>Block Type</label>
  <select name="type" required>
    <option value="page_builder">Page Builder</option>
    <option value="components">Components</option>
  </select>

  <label>Block Name</label>
  <input type="text" name="block" required>

  <h3>Fields</h3>
  <div id="fields"></div>

  <!-- Inline form to add a new field -->
  <div id="new-field-form" style="margin-top: 1em; padding: 1em; border: 1px solid #ccc;">
    <h4>Add New Field</h4>
    <label>Field Name</label>
    <input type="text" id="fieldName">

    <label>Field Type</label>
    <select id="fieldType">
      <option value="text">Text</option>
      <option value="textarea">Textarea</option>
      <option value="assets">Assets</option>
    </select>

    <label>Field Label</label>
    <input type="text" id="fieldLabel">

    <label>
      <input type="checkbox" id="fieldRequired"> Required
    </label>

    <label>Default Value</label>
    <input type="text" id="fieldDefault">

    <button type="button" onclick="addField()">Add Field</button>
  </div>

  <input type="hidden" name="fieldsJson" id="fieldsJson">

  <button type="submit">Create Block</button>
</form>

<script>
  const fields = [];

  function addField() {
    const name = document.getElementById("fieldName").value.trim();
    const type = document.getElementById("fieldType").value;
    const label = document.getElementById("fieldLabel").value.trim();
    const required = document.getElementById("fieldRequired").checked;
    const defaultValue = document.getElementById("fieldDefault").value.trim() || undefined;

    if (!name || !type || !label) {
      alert("Please fill in Name, Type, and Label.");
      return;
    }

    const field = { name, type, label, required, defaultValue };
    fields.push(field);

    renderFields();
    clearFieldForm();
  }

  function renderFields() {
    document.getElementById("fieldsJson").value = JSON.stringify(fields);
    const div = document.getElementById("fields");
    div.innerHTML = fields.map((f, i) =>
      `<div style="margin-bottom: .5em;">
        <strong>${f.label}</strong> (${f.type}) ${f.required ? '[required]' : ''}
        ${f.defaultValue ? `= "${f.defaultValue}"` : ''}
      </div>`
    ).join('');
  }

  function clearFieldForm() {
    document.getElementById("fieldName").value = "";
    document.getElementById("fieldType").value = "text";
    document.getElementById("fieldLabel").value = "";
    document.getElementById("fieldRequired").checked = false;
    document.getElementById("fieldDefault").value = "";
  }
</script>
